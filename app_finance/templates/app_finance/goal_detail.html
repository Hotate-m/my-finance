{% extends "app_finance/base.html" %}

{% block title %}‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢: {{ goal.name }}{% endblock %}

{% block content %}
<div class="mb-3 d-flex justify-content-between align-items-center flex-wrap gap-2">
  <div>
    <h1 class="h3 mb-1">{{ goal.name }}</h1>
    <div class="text-secondary" style="font-size:13px;">
      ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß ¬∑
      {% if goal.target_date %}
        ‡∏ñ‡∏∂‡∏á‡πÄ‡∏õ‡πâ‡∏≤: {{ goal.target_date|date:"d/m/Y" }}
        {% if days_left is not None %}
          (‡πÄ‡∏´‡∏•‡∏∑‡∏≠ {{ days_left }} ‡∏ß‡∏±‡∏ô)
        {% endif %}
      {% else %}
        ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ß‡∏±‡∏ô‡πÄ‡∏õ‡πâ‡∏≤
      {% endif %}
    </div>
  </div>
  <div class="d-flex flex-wrap gap-2">
    <a href="{% url 'app_finance:goals_list' %}" class="btn btn-ghost btn-sm">
      ‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
    </a>
    <a href="{% url 'app_finance:transaction_create' %}?goal={{ goal.id }}&type={{ goal.direction }}" class="btn btn-brand btn-sm">
      + ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏ô‡∏µ‡πâ
    </a>
  </div>
</div>

<div class="row g-4 mb-4">
  <div class="col-12 col-lg-5">
    <div class="card-soft p-3 h-100">
      <div class="mb-2">
        <div class="text-secondary" style="font-size:12px;">‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á</div>
        <div class="fw-semibold">
          {{ goal.account.name|default:"-" }}
        </div>
      </div>

      <div class="mb-2">
        <div class="text-secondary" style="font-size:12px;">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ó‡∏µ‡πà‡∏ô‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤</div>
        <div class="fw-semibold">
          {% if goal.direction == "IN" %}‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤{% else %}‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏≠‡∏Å{% endif %}
        </div>
      </div>

      <div class="mb-2">
        <div class="text-secondary" style="font-size:12px;">‡∏¢‡∏≠‡∏î‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢</div>
        <div class="fw-semibold">
          ‡∏ø{{ target|floatformat:2 }}
        </div>
      </div>

      <div class="mb-2">
        <div class="text-secondary" style="font-size:12px;">‡∏ó‡∏≥‡πÑ‡∏î‡πâ‡πÅ‡∏•‡πâ‡∏ß</div>
        <div class="fw-semibold text-success">
          ‡∏ø{{ done|floatformat:2 }}
        </div>
      </div>

      <div class="mb-3">
        <div class="text-secondary" style="font-size:12px;">‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</div>
        <div class="fw-semibold {% if remaining < 0 %}text-success{% else %}text-secondary{% endif %}">
          ‡∏ø{{ remaining|floatformat:2 }}
        </div>
      </div>

      <div class="mb-2">
        <div class="d-flex justify-content-between align-items-center mb-1">
          <span class="text-secondary" style="font-size:12px;">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤</span>
          {% if percent is not None %}
            <span style="font-size:12px;">{{ percent|floatformat:0 }}%</span>
          {% endif %}
        </div>
        {% if percent is not None %}
          <div style="width:100%;height:9px;border-radius:999px;background:#020617;overflow:hidden;border:1px solid rgba(148,163,184,.7);">
            {% with p=percent %}
              <div style="
                height:100%;
                width:{% if p > 100 %}100{% else %}{{ p|floatformat:0 }}{% endif %}%;
                {% if p < 50 %}
                  background:linear-gradient(to right,#22c55e,#4ade80);
                {% elif p < 100 %}
                  background:linear-gradient(to right,#eab308,#f97316);
                {% else %}
                  background:linear-gradient(to right,#22c55e,#16a34a);
                {% endif %}
              "></div>
            {% endwith %}
          </div>
        {% else %}
          <div class="text-secondary" style="font-size:12px;">
            ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ ‡∏à‡∏∂‡∏á‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ
          </div>
        {% endif %}
      </div>

      {% if goal.note %}
        <div class="mt-3">
          <div class="text-secondary" style="font-size:12px;">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢</div>
          <div style="font-size:13px;">{{ goal.note }}</div>
        </div>
      {% endif %}
    </div>
  </div>

  <div class="col-12 col-lg-7">
    <div class="card-soft-ghost p-3 h-100">
      <div class="d-flex justify-content-between align-items-center mb-2">
        <div class="fw-semibold">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏ô‡∏µ‡πâ</div>
        <span class="badge-chip">{{ transactions|length }} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span>
      </div>

      {% if transactions %}
        <div class="table-responsive">
          <table class="table table-dark table-sm align-middle mb-0" style="font-size:13px;">
            <thead>
              <tr class="text-secondary">
                <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                <th>‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</th>
                <th>‡∏´‡∏°‡∏ß‡∏î</th>
                <th class="text-end">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</th>
                <th>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</th>
                <th class="text-center">‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô</th>
              </tr>
            </thead>
            <tbody>
              {% for t in transactions %}
                <tr>
                  <td>{{ t.date|date:"d/m/Y" }}</td>
                  <td>{{ t.account.name }}</td>
                  <td>{{ t.category.name|default:"-" }}</td>
                  <td class="text-end {% if t.direction == 'OUT' %}text-danger{% else %}text-success{% endif %}">
                    {% if t.direction == 'OUT' %}-{% endif %}
                    ‡∏ø{{ t.amount|floatformat:2 }}
                  </td>
                  <td>{{ t.note|default:"-" }}</td>
                  <td class="text-center">
                    {% if t.proof_file %}
                      <a href="{{ t.proof_file.url }}" target="_blank" title="‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à">
                        üßæ
                      </a>
                    {% else %}
                      <span class="text-secondary" style="font-size:11px;">-</span>
                    {% endif %}
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      {% else %}
        <div class="text-secondary" style="font-size:13px;">
          ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ú‡∏π‡∏Å‡∏Å‡∏±‡∏ö‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏ô‡∏µ‡πâ  
          ‡∏•‡∏≠‡∏á‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° ‚Äú‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏ô‡∏µ‡πâ‚Äù ‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡∏Ç‡∏ß‡∏≤‡∏î‡∏π‡∏Ñ‡∏±‡∏ö
        </div>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}
